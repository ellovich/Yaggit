<ResourceDictionary xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:assets="using:CoreUI.Assets">

    <Design.PreviewWith>

        <Grid Width="600" Height="400" ColumnDefinitions="Auto,Auto,*">

            <NavMenu Grid.Column="0">
                <NavMenu.Header>
                    <TextBlock
                        Grid.Column="1"
                        VerticalAlignment="Center"
                        Classes="h1"
                        Name="SidebarTitle"
                        Text="Аврора ТП"
                        />
                </NavMenu.Header>

                <NavMenu.Footer>
                    <IconButton
                        HorizontalAlignment="Stretch"
                        Background="{DynamicResource SecondColor}"
                        Classes="transparent"
                        SvgPath="{x:Static assets:Icons.cogs}"
                        />
                </NavMenu.Footer>

                <NavMenuItem Header="Menu 1">
                    <NavMenuItem.Icon>
                        <Rectangle Width="10" Height="10" Fill="Green" />
                    </NavMenuItem.Icon>
                    <NavMenuItem Description="Краткое описание" Header="Sub Menu 1" />
                    <NavMenuItem Header="Sub Menu 2" />
                    <NavMenuItem Header="Sub Menu 3">
                        <NavMenuItem Header="Menu 1">
                            <NavMenuItem.Icon>
                                <Rectangle Width="10" Height="10" Fill="Green" />
                            </NavMenuItem.Icon>
                            <NavMenuItem Description="Краткое описание" Header="Sub Menu 1" />
                            <NavMenuItem Header="Sub Menu 2" />
                            <NavMenuItem Header="Sub Menu 3" />
                        </NavMenuItem>
                    </NavMenuItem>
                </NavMenuItem>
                <NavMenuItem Header="Menu 2">
                    <NavMenuItem.Icon>
                        <Rectangle Width="40" Height="40" Fill="Green" />
                    </NavMenuItem.Icon>
                </NavMenuItem>
                <NavMenuItem Header="Menu 3">
                    <NavMenuItem.Icon>
                        <Rectangle Width="10" Height="10" Fill="Green" />
                    </NavMenuItem.Icon>
                </NavMenuItem>
            </NavMenu>


            <GridSplitter
                Grid.Column="1"
                Width="10"
                Margin="0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="{DynamicResource AccentColor}"
                CornerRadius="0 7 7 0"
                ShowsPreview="True"
                />

            <Border Grid.Column="2" Background="Green" />
        </Grid>

    </Design.PreviewWith>

    <ControlTheme x:Key="{x:Type NavMenu}" TargetType="NavMenu">
        <Setter Property="Grid.IsSharedSizeScope" Value="True" />
        <Setter Property="SubMenuIndent" Value="30" />
        <Setter Property="CornerRadius" Value="{DynamicResource DefaultCornerRadius}" />
        <Setter Property="Background" Value="{DynamicResource ThirdColor}" />
        <Setter Property="Template">
            <ControlTemplate TargetType="NavMenu">
                <Border Background="{TemplateBinding Background}" CornerRadius="{TemplateBinding CornerRadius}">

                    <Grid RowDefinitions="Auto, *, Auto">
                        <!--  Header  -->
                        <Panel Grid.Row="0" Margin="5 0" MinHeight="40" NavMenu.CanToggle="True">
                            <ContentPresenter HorizontalAlignment="Center" Content="{TemplateBinding Header}" IsVisible="{TemplateBinding IsHorizontalCollapsed, Converter={x:Static BoolConverters.Not}}" />

                            <PathIcon
                                Data="{DynamicResource NavigationMenuCollapseIconGlyph}"
                                Foreground="{DynamicResource AccentColor}"
                                Name="MenuCollapseIcon"
                                >
                                <PathIcon.Transitions>
                                    <Transitions>
                                        <TransformOperationsTransition Property="RenderTransform" Duration="0.2" />
                                    </Transitions>
                                </PathIcon.Transitions>
                            </PathIcon>
                        </Panel>

                        <!--  Menu Items  -->
                        <ScrollViewer
                            Grid.Row="1"
                            HorizontalAlignment="Stretch"
                            AllowAutoHide="True"
                            HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Auto"
                            >
                            <ScrollViewer.Styles>
                                <Style Selector="ScrollViewer /template/ ScrollBar">
                                    <Setter Property="Opacity" Value="0" />
                                </Style>
                                <Style Selector="ScrollViewer:pointerover">
                                    <Style Selector="^ /template/ ScrollBar#PART_HorizontalScrollBar">
                                        <Setter Property="Opacity" Value="1" />
                                    </Style>
                                    <Style Selector="^ /template/ ScrollBar#PART_VerticalScrollBar">
                                        <Setter Property="Opacity" Value="1" />
                                    </Style>
                                </Style>
                            </ScrollViewer.Styles>

                            <ItemsPresenter ItemsPanel="{TemplateBinding ItemsPanel}" Name="MenuItems" />
                        </ScrollViewer>

                        <!--  Footer  -->
                        <ContentPresenter Grid.Row="2" Content="{TemplateBinding Footer}" DockPanel.Dock="Bottom" />
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>

        <Style Selector="^:not(:horizontal-collapsed)">
            <Setter Property="Width" Value="{Binding $self.ExpandWidth}" />
            <Style Selector="^ /template/ PathIcon#MenuCollapseIcon">
                <Setter Property="Data" Value="{DynamicResource NavigationMenuCollapseIconGlyph}" />
                <Setter Property="ToolTip.Tip" Value="Свернуть меню" />
                <Setter Property="HorizontalAlignment" Value="Right" />
            </Style>
            <Style Selector="^ /template/ ItemsPresenter#MenuItems">
                <Setter Property="Margin" Value="0 0 16 0" />
            </Style>
        </Style>
        <Style Selector="^:horizontal-collapsed">
            <Setter Property="Width" Value="{Binding $self.CollapseWidth}" />
            <Setter Property="Grid.IsSharedSizeScope" Value="False" />
            <Style Selector="^ /template/ PathIcon#MenuCollapseIcon">
                <Setter Property="RenderTransform" Value="rotate(180deg)" />
                <!--<Setter Property="Data" Value="{DynamicResource NavigationMenuExpandIconGlyph}" />-->
                <Setter Property="ToolTip.Tip" Value="Развернуть меню" />
                <Setter Property="HorizontalAlignment" Value="Center" />
            </Style>
            <Style Selector="^ /template/ ItemsPresenter#MenuItems">
                <Setter Property="Margin" Value="0 0 5 0" />
            </Style>
        </Style>
    </ControlTheme>

    <ControlTemplate x:Key="DefaultNavMenuItemTemplate" TargetType="NavMenuItem">
        <Grid RowDefinitions="Auto, *">
            <Border
                Grid.Row="0"
                MinHeight="20"
                Margin="5 0 0 0"
                HorizontalAlignment="Stretch"
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                CornerRadius="{DynamicResource DefaultCornerRadius}"
                Cursor="Hand"
                Name="PART_Border"
                >
                <Grid HorizontalAlignment="Stretch" VerticalAlignment="Center" Name="PART_RootGrid">
                    <Grid.Margin>
                        <MultiBinding Converter="{StaticResource NavMarginConverter}">
                            <Binding Path="SubMenuIndent" RelativeSource="{RelativeSource TemplatedParent}" />
                            <Binding Path="Level" RelativeSource="{RelativeSource TemplatedParent}" />
                            <Binding Path="IsHorizontalCollapsed" RelativeSource="{RelativeSource TemplatedParent}" />
                        </MultiBinding>
                    </Grid.Margin>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="Icon" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" SharedSizeGroup="Expander" />
                    </Grid.ColumnDefinitions>
                    <ContentPresenter
                        Padding="8"
                        HorizontalAlignment="Left"
                        Background="Transparent"
                        Content="{Binding Icon, RelativeSource={RelativeSource TemplatedParent}}"
                        ContentTemplate="{Binding IconTemplate, RelativeSource={RelativeSource TemplatedParent}}"
                        Name="PART_IconPresenter"
                        />

                    <Grid Grid.Column="1" RowDefinitions="*,Auto">
                        <ContentPresenter
                            Grid.Row="0"
                            Padding="0 6 0 2"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            Content="{Binding Header, RelativeSource={RelativeSource TemplatedParent}}"
                            ContentTemplate="{Binding HeaderTemplate, RelativeSource={RelativeSource TemplatedParent}}"
                            Name="PART_HeaderPresenter"
                            TextWrapping="Wrap"
                            />
                        <ContentPresenter
                            Grid.Row="1"
                            Padding="0 0 0 4"
                            Background="Transparent"
                            Content="{Binding Description, RelativeSource={RelativeSource TemplatedParent}}"
                            ContentTemplate="{Binding DescriptionTemplate, RelativeSource={RelativeSource TemplatedParent}}"
                            Name="PART_DescriptionPresenter"
                            TextWrapping="Wrap"
                            />
                    </Grid>

                    <PathIcon
                        Grid.Column="2"
                        Width="8"
                        Margin="4 0 8 0"
                        Data="{DynamicResource NavigationMenuItemExpandIconGlyph}"
                        Foreground="{DynamicResource TextNormal}"
                        Name="PART_ExpanderIcon"
                        >
                        <PathIcon.Transitions>
                            <Transitions>
                                <TransformOperationsTransition Property="RenderTransform" Duration="0.2" />
                            </Transitions>
                        </PathIcon.Transitions>
                    </PathIcon>
                    <Popup
                        Grid.Column="0"
                        IsLightDismissEnabled="True"
                        Name="PART_Popup"
                        Placement="RightEdgeAlignedTop"
                        PlacementTarget="{Binding #PART_Border}"
                        >
                        <Border
                            Margin="{DynamicResource NavigationMenuItemFlyoutMargin}"
                            Padding="5"
                            HorizontalAlignment="Stretch"
                            Background="{DynamicResource ThirdColor}"
                            BorderBrush="{DynamicResource Border}"
                            BorderThickness="{DynamicResource DefaultBorderThickness}"
                            CornerRadius="{DynamicResource DefaultCornerRadius}"
                            >
                            <StackPanel Name="PART_OverflowPanel" />
                        </Border>
                    </Popup>
                </Grid>
            </Border>
            <LayoutTransformControl Grid.Row="1" RenderTransformOrigin="0.5,0">
                <ItemsPresenter
                    Grid.Row="1"
                    Margin="0 4 0 0"
                    VerticalAlignment="Top"
                    Grid.IsSharedSizeScope="True"
                    ItemsPanel="{Binding ItemsPanel, RelativeSource={RelativeSource TemplatedParent}}"
                    Name="PART_ItemsPresenter"
                    RenderTransformOrigin="0.5,0"
                    >
                    <ItemsPresenter.Transitions>
                        <Transitions>
                            <DoubleTransition Easing="QuadraticEaseIn" Property="Height" Duration="0.25" />
                            <DoubleTransition Easing="QuadraticEaseOut" Property="Opacity" Duration="0.25" />
                            <TransformOperationsTransition Easing="QuadraticEaseInOut" Property="RenderTransform" Duration="0.25" />
                        </Transitions>
                    </ItemsPresenter.Transitions>
                </ItemsPresenter>
                <LayoutTransformControl.Transitions>
                    <Transitions>
                        <TransformOperationsTransition
                            Delay="0.1"
                            Easing="QuadraticEaseInOut"
                            Property="LayoutTransform"
                            Duration="0.15"
                            />
                    </Transitions>
                </LayoutTransformControl.Transitions>
            </LayoutTransformControl>
        </Grid>
    </ControlTemplate>

    <ControlTheme x:Key="{x:Type NavMenuItem}" TargetType="NavMenuItem">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="HorizontalAlignment" Value="Stretch" />
        <Setter Property="ItemsPanel">
            <ItemsPanelTemplate>
                <OverflowStackPanel />
            </ItemsPanelTemplate>
        </Setter>
        <Setter Property="Template" Value="{StaticResource DefaultNavMenuItemTemplate}" />
        <Style Selector="^:selected">
            <Setter Property="Foreground" Value="{DynamicResource TextNormal}" />
            <Setter Property="Background" Value="{DynamicResource SidebarItemSelected}" />
            <Style Selector="^:pointerover">
                <Setter Property="Foreground" Value="{DynamicResource TextHover}" />
                <Setter Property="Background" Value="{DynamicResource SidebarItemHover}" />
            </Style>
        </Style>
        <Style Selector="^:vertical-collapsed /template/ ItemsPresenter#PART_ItemsPresenter">
            <Setter Property="Height" Value="0" />
            <Setter Property="Opacity" Value="0" />
            <Setter Property="RenderTransform" Value="scale(1,0)" />
        </Style>
        <Style Selector="^:vertical-collapsed /template/ LayoutTransformControl">
            <Setter Property="LayoutTransform" Value="scale(1,0)" />
        </Style>
        <Style Selector="^:vertical-collapsed /template/ PathIcon#PART_ExpanderIcon">
            <Setter Property="RenderTransform" Value="rotate(180deg)" />
        </Style>
        <Style Selector="^:empty /template/ PathIcon#PART_ExpanderIcon">
            <Setter Property="IsVisible" Value="False" />
        </Style>
        <Style Selector="^ /template/ Border#PART_Border:pointerover">
            <Setter Property="Background" Value="{DynamicResource SidebarItemHover}" />
        </Style>
        <Style Selector="^ /template/ ContentPresenter#PART_HeaderPresenter:pointerover">
            <Setter Property="Foreground" Value="{DynamicResource TextHover}" />
        </Style>
        <Style Selector="^:horizontal-collapsed:first-level">
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Style Selector="^ /template/ Border#PART_Border">
                <Setter Property="ToolTip.Tip">
                    <Template>
                        <ContentPresenter Content="{TemplateBinding NavMenuItem.Header}" ContentTemplate="{TemplateBinding NavMenuItem.HeaderTemplate}" />
                    </Template>
                </Setter>
                <Setter Property="ToolTip.ShowDelay" Value="0" />
                <Setter Property="HorizontalAlignment" Value="Stretch" />
            </Style>
            <Style Selector="^ /template/ Border#PART_Border:pointerover">
                <Setter Property="Background" Value="{DynamicResource SidebarItemHover}" />
            </Style>
            <Style Selector="^ /template/ ContentPresenter#PART_IconPresenter">
                <Setter Property="Grid.ColumnSpan" Value="3" />
                <Setter Property="Margin" Value="0 8" />
                <Setter Property="HorizontalAlignment" Value="Center" />
            </Style>
            <Style Selector="^ /template/ ContentPresenter#PART_HeaderPresenter">
                <Setter Property="IsVisible" Value="False" />
            </Style>
            <Style Selector="^ /template/ ContentPresenter#PART_DescriptionPresenter">
                <Setter Property="IsVisible" Value="False" />
            </Style>
            <Style Selector="^ /template/ PathIcon#PART_ExpanderIcon">
                <Setter Property="IsVisible" Value="False" />
            </Style>
            <Style Selector="^ /template/ ItemsPresenter#PART_ItemsPresenter">
                <Setter Property="IsVisible" Value="False" />
            </Style>
        </Style>
        <Style Selector="^:horizontal-collapsed:not(:first-level)">
            <Style Selector="^ /template/ PathIcon#PART_ExpanderIcon">
                <Setter Property="RenderTransform" Value="rotate(-90deg)" />
            </Style>
        </Style>
        <Style Selector="^:horizontal-collapsed:first-level">
            <Setter Property="Grid.IsSharedSizeScope" Value="True" />
        </Style>
        <Style Selector="^[IsSeparator=True]">
            <Setter Property="Template">
                <ControlTemplate>
                    <StackPanel Margin="{DynamicResource NavigationMenuSeparatorMargin}" Cursor="No" Name="PART_RootPanel">
                        <ContentPresenter
                            Margin="{DynamicResource NavigationMenuSeparatorHeaderMargin}"
                            HorizontalAlignment="Left"
                            Content="{TemplateBinding Header}"
                            ContentTemplate="{TemplateBinding HeaderTemplate}"
                            Foreground="{DynamicResource TextNormal}"
                            IsVisible="{TemplateBinding Header, Converter={x:Static ObjectConverters.IsNotNull}}"
                            Name="PART_HeaderPresenter"
                            >
                            <ContentPresenter.Styles>
                                <Style Selector="TextBlock">
                                    <Setter Property="FontSize" Value="{DynamicResource NavigationMenuSeparatorHeaderFontSize}" />
                                </Style>
                            </ContentPresenter.Styles>
                        </ContentPresenter>
                        <Rectangle
                            Height="{DynamicResource NavigationMenuSeparatorBorderHeight}"
                            Margin="{DynamicResource NavigationMenuSeparatorBorderMargin}"
                            HorizontalAlignment="Stretch"
                            Fill="{DynamicResource TextNormal}"
                            Name="PART_SeparatorBorder"
                            />
                    </StackPanel>
                </ControlTemplate>
            </Setter>
            <Style Selector="^:horizontal-collapsed:first-level">
                <Setter Property="HorizontalAlignment" Value="Center" />
                <Style Selector="^ /template/ ContentPresenter#PART_HeaderPresenter">
                    <Setter Property="IsVisible" Value="False" />
                </Style>
                <Style Selector="^ /template/ ContentPresenter#PART_DescriptionPresenter">
                    <Setter Property="IsVisible" Value="False" />
                </Style>
                <Style Selector="^ /template/ Rectangle#PART_SeparatorBorder">
                    <Setter Property="HorizontalAlignment" Value="Center" />
                    <Setter Property="Width" Value="12" />
                </Style>
            </Style>
        </Style>
    </ControlTheme>

</ResourceDictionary>